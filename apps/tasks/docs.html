<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>توثيق فلاتر المهام (Tasks Filters)</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif; line-height: 1.7; margin: 24px; color: #111; }
    header { margin-bottom: 20px; }
    h1 { font-size: 22px; margin: 0 0 8px; }
    .muted { color: #555; font-size: 14px; }
    .box { border: 1px solid #ddd; border-radius: 10px; padding: 14px 16px; margin: 14px 0; background: #fafafa; }
    h2 { font-size: 18px; margin: 18px 0 8px; }
    h3 { font-size: 16px; margin: 14px 0 8px; }
    code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    pre { background: #0b1020; color: #e8e8e8; padding: 12px; border-radius: 10px; overflow: auto; }
    .tag { display: inline-block; border: 1px solid #ccc; border-radius: 999px; padding: 2px 10px; font-size: 12px; margin: 0 0 6px 6px; background: #fff; }
    table { width: 100%; border-collapse: collapse; margin: 10px 0; }
    th, td { border: 1px solid #ddd; padding: 8px 10px; vertical-align: top; }
    th { background: #f3f3f3; }
    .note { background: #fff8db; border: 1px solid #f0d77a; }
    .ok { background: #eaffea; border: 1px solid #a8e0a8; }
    .danger { background: #ffecec; border: 1px solid #ffb3b3; }
    ul { margin: 6px 0 6px 0; padding-right: 18px; }
    .footer { margin-top: 18px; font-size: 13px; color: #555; }
  </style>
</head>

<body>
  <header>
    <h1>تقرير واجهة المستخدم: فلاتر وبحث وترتيب المهام (Tasks)</h1>
    <div class="muted">
      هذا الملف يشرح للـ Frontend كيف يستخدم query params لقراءة قائمة المهام مع الفلاتر والبحث والترتيب.
      <br />
      مثال endpoint: <code>/tasks/</code>
    </div>
  </header>

  <div class="box note">
    <strong>ملاحظة مهمة:</strong>
    كل النتائج تكون تلقائيًا ضمن مهام المستخدم الحالي فقط (Backend يقوم بعمل <code>filter(user=request.user)</code>).
    لذلك لا يوجد فلتر للمستخدم <code>user</code> في الـ API.
  </div>

  <h2>1) شكل الطلب العام</h2>
  <div class="box">
    <div class="tag">GET</div>
    <code>/tasks/?param=value&amp;param2=value2</code>

    <h3>مثال سريع</h3>
    <pre>GET /tasks/?status=in-progress&priority=high&ordering=priority_rank,due_date</pre>
  </div>

  <h2>2) البحث (Search)</h2>
  <div class="box">
    <p>
      لديك طريقتين للبحث النصّي:
    </p>
    <ul>
      <li><code>search</code> (DRF SearchFilter): يبحث في <code>title</code> و <code>description</code>.</li>
      <li><code>q</code> (فلتر مخصص): أيضًا يبحث في <code>title</code> أو <code>description</code>.</li>
    </ul>

    <table>
      <thead>
        <tr>
          <th>الباراميتر</th>
          <th>الوصف</th>
          <th>مثال</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>search</code></td>
          <td>بحث عام (contains) في العنوان والوصف</td>
          <td><code>/tasks/?search=meeting</code></td>
        </tr>
        <tr>
          <td><code>q</code></td>
          <td>بحث مخصص (OR) في العنوان أو الوصف</td>
          <td><code>/tasks/?q=meeting</code></td>
        </tr>
      </tbody>
    </table>

    <div class="box ok">
      <strong>نصيحة Frontend:</strong> استخدم <code>search</code> كخيار افتراضي للبحث في مربع البحث.
      وإذا احتجت سلوك مختلف لاحقًا تستطيع الانتقال إلى <code>q</code>.
    </div>
  </div>

  <h2>3) فلاتر أساسية (Exact + IN)</h2>
  <div class="box">
    <p>هذه الفلاتر تعتمد على قيم Choices الموجودة في الموديل:</p>

    <h3>status (حالة المهمة)</h3>
    <ul>
      <li>القيم المتاحة: <code>in-progress</code> ، <code>completed</code></li>
    </ul>

    <h3>priority (الأولوية)</h3>
    <ul>
      <li>القيم المتاحة: <code>high</code> ، <code>medium</code> ، <code>low</code></li>
    </ul>

    <table>
      <thead>
        <tr>
          <th>الباراميتر</th>
          <th>الوصف</th>
          <th>مثال</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>status</code></td>
          <td>فلترة بالحالة (exact)</td>
          <td><code>/tasks/?status=completed</code></td>
        </tr>
        <tr>
          <td><code>status__in</code></td>
          <td>أكثر من حالة (قائمة مفصولة بفواصل)</td>
          <td><code>/tasks/?status__in=completed,in-progress</code></td>
        </tr>
        <tr>
          <td><code>priority</code></td>
          <td>فلترة بالأولوية (exact)</td>
          <td><code>/tasks/?priority=high</code></td>
        </tr>
        <tr>
          <td><code>priority__in</code></td>
          <td>أكثر من أولوية</td>
          <td><code>/tasks/?priority__in=high,medium</code></td>
        </tr>
      </tbody>
    </table>

    <div class="box note">
      <strong>ملاحظة:</strong> فلتر <code>__in</code> يقبل قيم مثل:
      <code>high,medium</code> بدون مسافات (يفضل).
    </div>
  </div>

  <h2>4) فلاتر النصوص (Title / Description)</h2>
  <div class="box">
    <table>
      <thead>
        <tr>
          <th>الباراميتر</th>
          <th>الوصف</th>
          <th>مثال</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>title</code></td>
          <td>مطابقة العنوان بالكامل (exact)</td>
          <td><code>/tasks/?title=My Task</code></td>
        </tr>
        <tr>
          <td><code>title__icontains</code></td>
          <td>بحث داخل العنوان (غير حساس لحالة الأحرف)</td>
          <td><code>/tasks/?title__icontains=task</code></td>
        </tr>
        <tr>
          <td><code>title__istartswith</code></td>
          <td>يبدأ بـ (غير حساس لحالة الأحرف)</td>
          <td><code>/tasks/?title__istartswith=meet</code></td>
        </tr>
        <tr>
          <td><code>description__icontains</code></td>
          <td>بحث داخل الوصف</td>
          <td><code>/tasks/?description__icontains=doctor</code></td>
        </tr>
      </tbody>
    </table>
  </div>

  <h2>5) فلاتر التاريخ والوقت (Dates)</h2>
  <div class="box">
    <p>
      الفلاتر التالية تعمل على <code>start_date</code> و <code>due_date</code>.
      الشكل المفضل للوقت: ISO 8601 مثل:
      <code>2026-01-01T00:00:00Z</code>
    </p>

    <table>
      <thead>
        <tr>
          <th>الباراميتر</th>
          <th>الوصف</th>
          <th>مثال</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>due_date</code></td>
          <td>فلترة بتاريخ/وقت الاستحقاق exact</td>
          <td><code>/tasks/?due_date=2026-01-10T12:00:00Z</code></td>
        </tr>
        <tr>
          <td><code>due_date__gte</code></td>
          <td>استحقاق بعد أو يساوي</td>
          <td><code>/tasks/?due_date__gte=2026-01-01T00:00:00Z</code></td>
        </tr>
        <tr>
          <td><code>due_date__lte</code></td>
          <td>استحقاق قبل أو يساوي</td>
          <td><code>/tasks/?due_date__lte=2026-01-31T23:59:59Z</code></td>
        </tr>
        <tr>
          <td><code>due_date__range_after</code> + <code>due_date__range_before</code></td>
          <td>نطاق تاريخ الاستحقاق (من/إلى)</td>
          <td>
            <code>/tasks/?due_date__range_after=2026-01-01T00:00:00Z&amp;due_date__range_before=2026-01-31T23:59:59Z</code>
          </td>
        </tr>

        <tr>
          <td><code>start_date__gte</code></td>
          <td>تاريخ بدء بعد أو يساوي</td>
          <td><code>/tasks/?start_date__gte=2026-01-01T00:00:00Z</code></td>
        </tr>
        <tr>
          <td><code>start_date__lte</code></td>
          <td>تاريخ بدء قبل أو يساوي</td>
          <td><code>/tasks/?start_date__lte=2026-01-31T23:59:59Z</code></td>
        </tr>
      </tbody>
    </table>

    <div class="box danger">
      <strong>تنبيه:</strong>
      بعض مكتبات Frontend قد ترسل التاريخ بدون <code>Z</code> أو timezone.
      الأفضل دائمًا إرسال ISO كامل مع timezone لتجنب اختلافات التوقيت.
    </div>
  </div>

  <h2>6) فلاتر ذكية (Overdue / Due Today / Due In Days)</h2>
  <div class="box">
    <table>
      <thead>
        <tr>
          <th>الباراميتر</th>
          <th>نوعه</th>
          <th>الوصف</th>
          <th>مثال</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>overdue</code></td>
          <td>Boolean</td>
          <td>
            عند <code>true</code> يعيد المهام المتأخرة فقط:
            (<code>due_date &lt; الآن</code> و <code>status=in-progress</code>)
          </td>
          <td><code>/tasks/?overdue=true</code></td>
        </tr>
        <tr>
          <td><code>due_today</code></td>
          <td>Boolean</td>
          <td>المهام المستحقة اليوم (حسب تاريخ <code>due_date</code>)</td>
          <td><code>/tasks/?due_today=true</code></td>
        </tr>
        <tr>
          <td><code>due_in_days</code></td>
          <td>Number</td>
          <td>المهام المستحقة خلال N يوم القادمة (من الآن وحتى N)</td>
          <td><code>/tasks/?due_in_days=7</code></td>
        </tr>
      </tbody>
    </table>

    <div class="box note">
      <strong>ملاحظة:</strong>
      قيم boolean الأفضل إرسالها مثل: <code>true</code> / <code>false</code>.
    </div>
  </div>

  <h2>7) الترتيب (Ordering)</h2>
  <div class="box">
    <p>
      الترتيب يتم عبر باراميتر <code>ordering</code>.
      لإضافة تنازلي ضع <code>-</code> قبل اسم الحقل.
    </p>

    <h3>الحقول المدعومة للترتيب</h3>
    <ul>
      <li><code>id</code></li>
      <li><code>title</code></li>
      <li><code>status</code></li>
      <li><code>priority</code></li>
      <li><code>start_date</code></li>
      <li><code>due_date</code></li>
      <li><code>priority_rank</code> (مهم جدًا لترتيب الأولوية بشكل منطقي)</li>
    </ul>

    <h3>ما هو priority_rank؟</h3>
    <div class="box note">
      <p>
        تم إضافة <code>priority_rank</code> من جهة الـ Backend كقيمة رقمية للفرز الصحيح:
      </p>
      <ul>
        <li><code>high</code> =&gt; 0</li>
        <li><code>medium</code> =&gt; 1</li>
        <li><code>low</code> =&gt; 2</li>
      </ul>
      <p>
        بالتالي عند استخدام <code>ordering=priority_rank</code> سيظهر "High" أولًا ثم "Medium" ثم "Low".
      </p>
    </div>

    <table>
      <thead>
        <tr>
          <th>مثال ترتيب</th>
          <th>النتيجة</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>/tasks/?ordering=due_date</code></td>
          <td>أقرب استحقاق أولًا</td>
        </tr>
        <tr>
          <td><code>/tasks/?ordering=-due_date</code></td>
          <td>أبعد استحقاق أولًا</td>
        </tr>
        <tr>
          <td><code>/tasks/?ordering=priority_rank,due_date</code></td>
          <td>أولوية أعلى أولًا، ثم الأقرب استحقاق</td>
        </tr>
        <tr>
          <td><code>/tasks/?ordering=-start_date</code></td>
          <td>الأحدث إنشاءً أولًا</td>
        </tr>
      </tbody>
    </table>
  </div>

  <h2>8) أمثلة جاهزة للاستخدام في الواجهة</h2>
  <div class="box">
    <h3>أ) شاشة "مهامي اليوم"</h3>
    <pre>GET /tasks/?due_today=true&ordering=priority_rank,due_date</pre>

    <h3>ب) شاشة "المتأخرات"</h3>
    <pre>GET /tasks/?overdue=true&ordering=due_date</pre>

    <h3>ج) شاشة "الأسبوع القادم"</h3>
    <pre>GET /tasks/?due_in_days=7&ordering=priority_rank,due_date</pre>

    <h3>د) بحث + فلترة</h3>
    <pre>GET /tasks/?search=call&status=in-progress&ordering=due_date</pre>

    <h3>هـ) أكثر من قيمة (IN)</h3>
    <pre>GET /tasks/?priority__in=high,medium&status__in=in-progress,completed</pre>
  </div>

  <div class="footer">
    © توثيق داخلي للـ Frontend — يمكن نسخه داخل صفحة Docs أو Notion أو داخل المشروع كملف HTML.
  </div>
</body>
</html>
